syntax = "proto3";
package computer_vision_sports_proto;

import "common.proto";

service ComputerVisionGolfService {
    rpc showDTLPoseImage(ShowDTLPoseImageRequest) returns (ShowDTLPoseImageResponse) {}
    rpc showFaceOnPoseImage(ShowFaceOnPoseImageRequest) returns (ShowFaceOnPoseImageResponse) {}
    rpc getDTLPoseSetupPoints(GetDTLPoseSetupPointsRequest) returns (GetDTLPoseSetupPointsResponse) {}
    rpc getFaceOnPoseSetupPoints(GetFaceOnPoseSetupPointsRequest) returns (GetFaceOnPoseSetupPointsResponse) {}
    rpc identifyDTLPoseDifferences(IdentifyDTLPoseDifferencesRequest) returns (IdentifyDTLPoseDifferencesResponse) {}
    rpc identifyFaceOnPoseDifferences(IdentifyFaceOnPoseDifferencesRequest) returns (IdentifyFaceOnPoseDifferencesResponse) {}
    //rpc identifyDTLGripDifferences (ImagePair) returns {}
    //rpc identifyFaceOnGripDifferences (ImagePair) returns {}
    //rpc identifyDTLWeightDistributionDifferences (ImagePair) returns {}
    //rpc identifyFaceOnWeightDistributionDifferences (ImagePair) returns {}
    //rpc showFaceOnAllData(Image) returns {}
    //rpc showDTLAllData(Image) returns {}

    rpc showDTLPoseImagesFromVideo(stream ShowDTLPoseImageRequest) returns (stream ShowDTLPoseImageResponse) {}
    rpc showFaceOnPoseImagesFromVideo(stream ShowFaceOnPoseImageRequest) returns (stream ShowFaceOnPoseImageResponse) {}
    //rpc identifyDTLTempoDifferencesFromVideo(stream ImagePair) returns {}
    //rpc identifyFaceOnTempoDifferencesFromVideo(stream ImagePair) returns {}
    //rpc identifyDTLWeightDistributionDifferencesFromVideo (stream ImagePair) returns {}
    //rpc identifyFaceOnWeightDistributionDifferencesFromVideo (stream ImagePair) returns {}

    //TODO: User CRUD rpcs: CreateUser, ReadUser, UpdateUser, DeleteUser
    //TODO: Image/Video CRUD rpcs: CreateImage, CreateVideo, ... 
}

message ShowDTLPoseImageRequest {
    Image image = 1;
}

message ShowDTLPoseImageResponse {
    Image image = 2;
}

message ShowFaceOnPoseImageRequest {
    Image image = 1;
}

message ShowFaceOnPoseImageResponse {
    Image image = 2;
}

message GetDTLPoseSetupPointsRequest {
    CalibratedDTLImage calibrated_image = 1;
    //bool lefthanded = 2; // TODO: Add lefty support
}

message GetDTLPoseSetupPointsResponse {
    DTLGolfSetupPoints setup_points = 1;
}

message GetFaceOnPoseSetupPointsRequest {
    CalibratedFaceOnImage calibrated_image = 1;
}

message GetFaceOnPoseSetupPointsResponse {
    FaceOnGolfSetupPoints setup_points = 1;
}


message IdentifyDTLPoseDifferencesRequest {
    CalibratedDTLImage original_calibrated_image = 1;
    CalibratedDTLImage new_calibrated_image = 2;
    //float angle_tolerance = 2; // how much difference there has to be in angle to report as a difference (might have to be tolerance for each field with some default values)
}

message IdentifyDTLPoseDifferencesResponse {
    DTLGolfSetupPoints setup_points_original = 1;
    DTLGolfSetupPoints setup_points_new = 2;
    DTLGolfSetupPoints setup_points_diff = 3;
}

message IdentifyFaceOnPoseDifferencesRequest {
    CalibratedFaceOnImage original_calibrated_image = 1;
    CalibratedFaceOnImage new_calibrated_image = 2;
    //float angle_tolerance = 2;
}

message IdentifyFaceOnPoseDifferencesResponse {
    FaceOnGolfSetupPoints setup_points_original = 1;
    FaceOnGolfSetupPoints setup_points_new = 2;
    FaceOnGolfSetupPoints setup_points_diff = 3;
}

// calibration image and image should be same env and not move camera between
// recommend taking a video, doing poses for calibration, then swinging all in 1 video, then take snapshots at each image wanted
message CalibratedDTLImage {
    FeetLineMethod method = 1;
    Image calibration_image_axes = 2;
    Image calibration_image_vanishing_point = 3;
    Image image = 4;
}

// calibration image and image should be same env and not move camera between
// recommend taking a video, doing poses for calibration, then swinging all in 1 video, then take snapshots at each image wanted
message CalibratedFaceOnImage {
    FeetLineMethod method = 1;
    Image calibration_image_axes = 2; // stand straight up looking at camera, with feet out perpendicular to camera (determines horizontal and vertical axes and able to 3d)
    Image image = 3;
}

enum FeetLineMethod {
    DEFAULT = 0; // use heel line
    USE_HEEL_LINE = 1;
    USE_TOE_LINE = 2;
}

message DTLGolfSetupPoints {
    Double spine_angle = 1;
    Double feet_alignment = 2;
    Double heel_alignment = 3;
    Double toe_alignment = 4;
    //shoulder_alignment
    //waist_alignment
    //distance_from_ball
    //ulnar_deviation
    //knee_bend
    //waist_bend
    //neck_angle
    //spine_bend
}

message FaceOnGolfSetupPoints {
    Double side_bend = 1;
    //l_foot_flare
    //r_foot_flare
    //stance_width
    //shoulder_angle
    //waist_angle
    //shaft_lean
    //ball_position
    //head_position
    //chest_position
}

/*message GripSetup {

}*/
