syntax = "proto3";
package sports_keypoints_proto;

import "common.proto";
import "google/protobuf/timestamp.proto";

service GolfKeypointsService {
    rpc UploadInputImage(UploadInputImageRequest) returns (UploadInputImageResponse) {}
    rpc ListInputImagesForUser(ListInputImagesForUserRequest) returns (ListInputImagesForUserResponse) {}
    rpc ReadInputImage(ReadInputImageRequest) returns (ReadInputImageResponse) {}
    rpc DeleteInputImage(DeleteInputImageRequest) returns (DeleteInputImageResponse) {}

    // optional if want specific keypoints
    rpc CalibrateInputImage(CalibrateInputImageRequest) returns (CalibrateInputImageResponse) {}

    rpc CalculateGolfKeypoints(CalculateGolfKeypointsRequest) returns (CalculateGolfKeypointsResponse) {}
    rpc ReadGolfKeypoints(ReadGolfKeypointsRequest) returns (ReadGolfKeypointsResponse) {}
    // if estimated body keypoints are off or have low confidence, client can manually input where body parts are
    rpc UpdateBodyKeypoints(UpdateBodyKeypointsRequest) returns (UpdateBodyKeypointsResponse) {}
    rpc DeleteGolfKeypoints(DeleteGolfKeypointsRequest) returns (DeleteGolfKeypointsResponse) {}

    // TODO: Stream for videos
}

message UploadInputImageRequest {
    string session_token = 1;
    ImageType image_type = 2;
    bytes image = 3;
    string description = 4;
    // timestamp for when this input image was uploaded
    google.protobuf.Timestamp timestamp = 5;
}

message UploadInputImageResponse {
    bool success = 1;
    string input_image_id = 2;
}

message ListInputImagesForUserRequest{
    string session_token = 1;
}

message ListInputImagesForUserResponse {
    bool success = 1;
    repeated string input_image_ids = 2;
}

message ReadInputImageRequest {
    string session_token = 1;
    string input_image_id = 2;
}

message ReadInputImageResponse {
    bool success = 1;
    ImageType image_type = 2;
    bytes image = 3;
    CalibrationType calibration_type = 4;
    FeetLineMethod feet_line_method = 5;
    string description = 6;
    // timestamp for when this input image was uploaded
    google.protobuf.Timestamp timestamp = 7;
}

message DeleteInputImageRequest {
    string session_token = 1;
    string input_image_id = 2;
}

message DeleteInputImageResponse {
    bool success = 1;
}

message CalibrateInputImageRequest {
    string session_token = 1;
    string input_image_id = 2;
    CalibrationType calibration_type = 3;
    FeetLineMethod feet_line_method = 4;
    // only required if want certain data for DTL and Face On
    bytes calibration_image_axes = 5;
    // only required if want certain data for DTL
    bytes calibration_image_vanishing_point = 6;
    // only required if want certain data such as distance from ball and ball position
    Keypoint golf_ball = 7;
    // only required if want certain data such as ulnar deviation and shaft lean (club_head is also required)
    Keypoint club_butt = 8;
    // only required if want certain data such as ulnar deviation and shaft lean (club_butt is also required)
    Keypoint club_head = 9;
    // only required if want DTL shoulder alignment
    Double shoulder_tilt = 10;
    // TODO: optional: horizontal line and vertical line points for axes calibration
    // TODO: optional: parallel line points for vanishing point
}

message CalibrateInputImageResponse {
    bool success = 1;
}

message CalculateGolfKeypointsRequest {
    string session_token = 1;
    string input_image_id = 2;
}

message CalculateGolfKeypointsResponse {
    bool success = 1;
    bytes output_image = 2;
    GolfKeypoints golf_keypoints = 3;
}

message ReadGolfKeypointsRequest {
    string session_token = 1;
    string input_image_id = 2;
}

message ReadGolfKeypointsResponse {
    bool success = 1;
    bytes output_image = 2;
    GolfKeypoints golf_keypoints = 3;
}

message UpdateBodyKeypointsRequest {
    string session_token = 1;
    string input_image_id = 2;
    Body25PoseKeypoints updated_body_keypoints = 3;
}

message UpdateBodyKeypointsResponse {
    bool success = 1;
    GolfKeypoints updated_golf_keypoints = 2;
}

message DeleteGolfKeypointsRequest {
    string session_token = 1;
    string input_image_id = 2;
}

message DeleteGolfKeypointsResponse {
    bool success = 1;
}

enum ImageType {
    IMAGE_TYPE_UNSPECIFIED = 0; 
    FACE_ON = 1;
    DTL = 2;
}

enum CalibrationType {
    NO_CALIBRATION = 0;
    AXES_CALIBRATION_ONLY = 1;
    // vanishing point requires axes calibration as well, same as full for Dtl, will just do axes if faceon
    AXES_AND_VANISHING_POINT_CALIBRATION = 2; 
    // axes for Faceon, axes and vanishing point for Dtl
    FULL_CALIBRATION = 3; 
}

enum FeetLineMethod {
    // will default to use heel line
    FEET_LINE_METHOD_UNSPECIFIED = 0; 
    USE_HEEL_LINE = 1;
    USE_TOE_LINE = 2;
}

message GolfKeypoints {
    DTLGolfSetupPoints dtl_golf_setup_points = 1;
    FaceOnGolfSetupPoints faceon_golf_setup_points = 2;
    Body25PoseKeypoints body_keypoints = 3;
}

message DTLGolfSetupPoints {
    // degrees from vertical, requires axes calibration
    Double spine_angle = 1;
    // degrees from target (negative is open, positive is closed), requires axes and vanishing point calibration
    Double feet_alignment = 2;
    // degrees from target (negative is open, positive is closed), requires axes and vanishing point calibration
    Double heel_alignment = 3;
    // degrees from target (negative is open, positive is closed), requires axes and vanishing point calibration
    Double toe_alignment = 4;
    // degrees from target (negative is open, positive is closed), requires axes and vanishing point calibration (note: shoulder alignment is very sensitive to detection)
    Double shoulder_alignment = 5;
    // degrees from target (negative is open, positive is closed), requires axes and vanishing point calibration (note: waist alignment is very sensitive to detection)
    Double waist_alignment = 6; 
    // degrees off from straight legs, the line from hip to knee and line from knee to ankle, for best results wear shorts/tighter pants
    Double knee_bend = 7;
    // ratio of distance from toe line to ball and line from midhip to neck, the larger the number the farther from the ball, requires golf ball calibration
    Double distance_from_ball = 8;
    // degrees from line running through right elbow to right wrist and the line from right wrist to club head, the bigger the angle the more ulnar deviation (ie. higher hands), requires club head calibration
    Double ulnar_deviation = 9; 
    // TODO: waist_bend: (same as spine angle??), neck_angle, chin_position/eye_gaze_position, spine_bend (requires a mid spine point), elbow_bend, arm stuff
}

message FaceOnGolfSetupPoints {
    // degrees from vertical (positive is right side bend, negative is left side bend), requires axes calibration
    Double side_bend = 1;
    // degrees from line running through midpoint of heels, perpendicular to target line (positive external feet, negative is internal feet), requires axes calibration
    Double l_foot_flare = 2;
    // degrees from line running through midpoint of heels, perpendicular to target line (positive external feet, negative is internal feet), requires axes calibration
    Double r_foot_flare = 3;
    // ratio of stance width to line from midhip to neck, the larger the number the wider the stance
    Double stance_width = 4;
    // degrees offset from horizontal axis, positive is trail shoulder lower, negative is lead shoulder lower, requires axes calibration
    Double shoulder_tilt = 5; 
    // degrees offset from horizontal axis, positive is trail hip lower, negative is lead hip lower, requires axes calibration
    Double waist_tilt = 6;
     // degrees offset from vertical axis, positive is forward shaft lean, negative is backwards shaft lean, requires axes calibration and club butt and club head calibration
    Double shaft_lean = 7;
    // degrees offset from line perpendicular to feet line running through midpoint of feet, positive is closer to lead side, negative is closer to trail side, requires golf ball calibration (note: ball position is sensitive to open/closed stances and camera angle)
    Double ball_position = 8; 
    // degrees offset from line perpendicular to feet line running through midpoint of feet, positive is closer to lead side, negative is closer to trail side (note: head position is sensitive to open/closed stances and camera angle)
    Double head_position = 9;
    // degrees offset from line perpendicular to feet line running through midpoint of feet, positive is closer to lead side, negative is closer to trail side (note: chest position is sensitive to open/closed stances and camera angle)
    Double chest_position = 10;
    // degrees offset from line perpendicular to feet line running through midpoint of feet, positive is closer to lead side, negative is closer to trail side (note: mid hip position is sensitive to open/closed stances and camera angle)
    Double mid_hip_position = 11;
    // TODO: arm stuff
}
